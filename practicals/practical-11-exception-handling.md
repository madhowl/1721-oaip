# Практическая работа 11: Обработка исключений

## Цель работы

Освоить основы обработки исключений в Python, научиться использовать конструкцию try-except для перехвата и обработки ошибок, а также создавать собственные исключения.

## Теоретическая часть

Обработка исключений - это механизм, позволяющий программе корректно реагировать на ошибки во время выполнения. В Python исключения могут возникать при различных ошибках: деление на ноль, работа с несуществующими файлами, неправильный ввод данных и т.д.

Базовый синтаксис обработки исключений:
```python
try:
    # Код, который может вызвать исключение
    pass
except SomeException:
    # Код для обработки исключения
    pass
else:
    # Код, который выполнится, если исключения не было
    pass
finally:
    # Код, который выполнится в любом случае
    pass
```

## Практические задания

### Задание 1: Простая обработка исключения

Создайте программу, которая запрашивает у пользователя два числа и делит первое на второе. Обработайте исключение, которое возникает при делении на ноль.

**Пример выполнения:**
```
Введите первое число: 10
Введите второе число: 0
Ошибка: деление на ноль!
```

**Код для выполнения:**
```python
try:
    num1 = float(input("Введите первое число: "))
    num2 = float(input("Введите второе число: "))
    
    result = num1 / num2
    print(f"Результат: {result}")
except ZeroDivisionError:
    print("Ошибка: деление на ноль!")
```

---

### Задание 2: Обработка нескольких типов исключений

Создайте программу, которая запрашивает у пользователя число и выводит его квадрат. Обработайте исключения, которые могут возникнуть при неправильном вводе.

**Пример выполнения:**
```
Введите число: abc
Ошибка: невозможно преобразовать в число!
```

**Код для выполнения:**
```python
try:
    user_input = input("Введите число: ")
    number = float(user_input)
    square = number ** 2
    print(f"Квадрат числа: {square}")
except ValueError:
    print("Ошибка: невозможно преобразовать в число!")
except Exception as e:
    print(f"Произошла непредвиденная ошибка: {e}")
```

---

### Задание 3: Блоки else и finally

Модифицируйте предыдущую программу, добавив блоки else и finally.

**Код для выполнения:**
```python
try:
    user_input = input("Введите число: ")
    number = float(user_input)
    square = number ** 2
except ValueError:
    print("Ошибка: невозможно преобразовать в число!")
except Exception as e:
    print(f"Произошла непредвиденная ошибка: {e}")
else:
    # Выполняется, если не было исключений
    print(f"Квадрат числа: {square}")
    print("Вычисление прошло успешно!")
finally:
    # Выполняется в любом случае
    print("Завершение работы программы")
```

---

### Задание 4: Обработка исключений при работе с файлами

Создайте программу, которая пытается открыть файл для чтения и обрабатывает возможные исключения.

**Код для выполнения:**
```python
filename = input("Введите имя файла для чтения: ")

try:
    with open(filename, 'r', encoding='utf-8') as file:
        content = file.read()
        print("Содержимое файла:")
        print(content)
except FileNotFoundError:
    print(f"Файл '{filename}' не найден")
except PermissionError:
    print(f"Нет доступа к файлу '{filename}'")
except UnicodeDecodeError:
    print(f"Ошибка кодировки файла '{filename}'")
except Exception as e:
    print(f"Произошла ошибка: {e}")
```

---

### Задание 5: Генерация исключений

Создайте программу, которая проверяет, является ли введенное число положительным. Если число отрицательное, генерируйте исключение ValueError.

**Пример выполнения:**
```
Введите число: -5
Ошибка: число должно быть положительным
```

**Код для выполнения:**
```python
def check_positive_number(number):
    """Проверяет, является ли число положительным"""
    if number < 0:
        raise ValueError("число должно быть положительным")
    return number

try:
    user_number = float(input("Введите число: "))
    validated_number = check_positive_number(user_number)
    print(f"Число {validated_number} является положительным")
except ValueError as e:
    print(f"Ошибка: {e}")
```

---

### Задание 6: Собственные классы исключений

Создайте собственный класс исключения для проверки корректности ввода пароля.

**Код для выполнения:**
```python
class PasswordTooShortError(Exception):
    """Исключение для случая, когда пароль слишком короткий"""
    pass

class PasswordNoDigitError(Exception):
    """Исключение для случая, когда пароль не содержит цифр"""
    pass

def validate_password(password):
    """Проверяет корректность пароля"""
    if len(password) < 8:
        raise PasswordTooShortError("Пароль должен содержать не менее 8 символов")
    
    has_digit = any(char.isdigit() for char in password)
    if not has_digit:
        raise PasswordNoDigitError("Пароль должен содержать хотя бы одну цифру")
    
    return True

# Пример использования
try:
    user_password = input("Введите пароль: ")
    validate_password(user_password)
    print("Пароль корректен!")
except PasswordTooShortError as e:
    print(f"Ошибка: {e}")
except PasswordNoDigitError as e:
    print(f"Ошибка: {e}")
except Exception as e:
    print(f"Произошла ошибка: {e}")
```

---

### Задание 7: Обработка исключений в цикле

Создайте программу, которая запрашивает у пользователя числа до тех пор, пока он не введет корректное число.

**Пример выполнения:**
```
Введите число: abc
Некорректный ввод. Попробуйте еще раз.
Введите число: -5
Некорректный ввод. Попробуйте еще раз.
Введите число: 42
Вы ввели число: 42.0
```

**Код для выполнения:**
```python
def get_number():
    """Запрашивает у пользователя число и возвращает его"""
    while True:
        try:
            user_input = input("Введите число: ")
            number = float(user_input)
            return number
        except ValueError:
            print("Некорректный ввод. Попробуйте еще раз.")
        except KeyboardInterrupt:
            print("\nПрограмма прервана пользователем")
            return None

result = get_number()
if result is not None:
    print(f"Вы ввели число: {result}")
```

---

### Задание 8: Обработка исключений при работе со списками

Создайте программу, которая запрашивает у пользователя индекс и выводит элемент списка по этому индексу. Обработайте исключение при выходе за пределы списка.

**Код для выполнения:**
```python
my_list = [10, 20, 30, 40, 50]

try:
    index = int(input("Введите индекс элемента: "))
    element = my_list[index]
    print(f"Элемент с индексом {index}: {element}")
except IndexError:
    print("Ошибка: индекс за пределами списка")
except ValueError:
    print("Ошибка: введите целое число")
except Exception as e:
    print(f"Произошла ошибка: {e}")
```

---

### Задание 9: Обработка исключений в функциях

Создайте функцию, которая делит два числа и обрабатывает возможные исключения. Функция должна возвращать результат или None в случае ошибки.

**Код для выполнения:**
```python
def safe_divide(a, b):
    """Безопасное деление двух чисел"""
    try:
        result = a / b
        return result
    except ZeroDivisionError:
        print("Ошибка: деление на ноль")
        return None
    except TypeError:
        print("Ошибка: неверный тип данных")
        return None

# Примеры использования
print(safe_divide(10, 2))    # 5.0
print(safe_divide(10, 0))    # Ошибка: деление на ноль, None
print(safe_divide(10, "a"))  # Ошибка: неверный тип данных, None
```

---

### Задание 10: Комплексная задача - калькулятор с обработкой исключений

Создайте программу калькулятора, которая обрабатывает все возможные исключения при выполнении операций.

**Код для выполнения:**
```python
def calculator():
    """Программа-калькулятор с обработкой исключений"""
    print("Калькулятор. Поддерживаемые операции: +, -, *, /")
    
    try:
        num1 = float(input("Введите первое число: "))
        operator = input("Введите операцию (+, -, *, /): ")
        num2 = float(input("Введите второе число: "))
        
        if operator == '+':
            result = num1 + num2
        elif operator == '-':
            result = num1 - num2
        elif operator == '*':
            result = num1 * num2
        elif operator == '/':
            if num2 == 0:
                raise ZeroDivisionError("деление на ноль")
            result = num1 / num2
        else:
            raise ValueError("неподдерживаемая операция")
        
        print(f"Результат: {num1} {operator} {num2} = {result}")
        
    except ValueError as e:
        if "could not convert" in str(e):
            print("Ошибка: введите числовое значение")
        else:
            print(f"Ошибка: {e}")
    except ZeroDivisionError as e:
        print(f"Ошибка: {e}")
    except Exception as e:
        print(f"Непредвиденная ошибка: {e}")

calculator()
```

---

## Дополнительные задания

### Задание 11: Обработка исключений при работе с JSON

Создайте программу, которая пытается распарсить JSON строку и обрабатывает возможные ошибки.

**Код для выполнения:**
```python
import json

def parse_json(json_string):
    """Парсит JSON строку"""
    try:
        data = json.loads(json_string)
        return data
    except json.JSONDecodeError as e:
        print(f"Ошибка парсинга JSON: {e}")
        return None
    except Exception as e:
        print(f"Непредвиденная ошибка: {e}")
        return None

# Примеры использования
valid_json = '{"name": "Иван", "age": 30}'
invalid_json = '{"name": "Иван", "age":}'

print(parse_json(valid_json))    # {'name': 'Иван', 'age': 30}
print(parse_json(invalid_json))  # Ошибка парсинга JSON: ...
```

---

### Задание 12: Контекстный менеджер с обработкой исключений

Создайте простой контекстный менеджер, который отслеживает время выполнения блока кода и обрабатывает исключения.

**Код для выполнения:**
```python
import time

class Timer:
    """Контекстный менеджер для измерения времени выполнения"""
    def __enter__(self):
        self.start_time = time.time()
        return self
    
    def __exit__(self, exc_type, exc_value, traceback):
        end_time = time.time()
        elapsed_time = end_time - self.start_time
        print(f"Время выполнения: {elapsed_time:.2f} секунд")
        
        # Если было исключение, выводим информацию о нем
        if exc_type:
            print(f"Произошло исключение: {exc_type.__name__}: {exc_value}")
        
        # Возвращаем False, чтобы исключение продолжило распространение
        return False

# Пример использования
try:
    with Timer():
        time.sleep(1)  # Имитация работы
        print("Выполняемая операция")
        # Могут быть исключения внутри блока
        # raise ValueError("Тестовое исключение")
except ValueError as e:
    print(f"Поймано исключение: {e}")
```

---

## Контрольные вопросы

1. Что такое исключение в Python?
2. Какой синтаксис используется для обработки исключений?
3. В чем разница между блоками except, else и finally?
4. Какие стандартные исключения вы знаете?
5. Как создать собственный класс исключения?
6. Для чего используется инструкция raise?
7. Как обработать несколько типов исключений?
8. Что такое контекстный менеджер и как он связан с обработкой исключений?
9. В чем преимущество обработки исключений перед проверкой условий?
10. Какие есть способы генерации исключений?

## Вывод

В ходе этой практической работы были освоены основы обработки исключений в Python. Были рассмотрены различные типы исключений, способы их перехвата и обработки, создание собственных классов исключений, а также применение обработки исключений в различных ситуациях. Правильная обработка исключений позволяет создавать более надежные и устойчивые к ошибкам программы.
